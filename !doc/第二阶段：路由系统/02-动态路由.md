# 动态路由

## 2.1 什么是动态路由？

动态路由是指路径中包含可变参数的路由，使用方括号 `[param]` 语法创建。

动态路由允许根据参数动态生成路由，适用于内容数量不固定的场景。

---

## 2.2 创建动态路由

### 基本语法

使用方括号 `[param]` 创建动态路由段：

```text
app/
└── blog/
    └── [id]/
        └── page.tsx
```

**对应的 URL 模式：** `/blog/[id]`

**实际访问的 URL：**
- `/blog/1`
- `/blog/2`
- `/blog/hello-world`

---

## 2.3 获取路由参数

### 使用 `params` 获取参数

在动态路由的 `page.tsx` 中，通过 `params` prop 获取路由参数：

```typescript
// app/blog/[id]/page.tsx
export default function BlogPostPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  // params.id 就是 URL 中的动态部分
  // 访问 /blog/123 时，params.id = "123"
  
  return (
    <div>
      <h1>博客文章 ID: {params.id}</h1>
    </div>
  )
}
```

---

## 2.4 实际示例

### 示例 1：博客详情页

**目录结构：**

```text
app/
└── blog/
    ├── page.tsx          # 博客列表页：/blog
    └── [id]/
        └── page.tsx      # 博客详情页：/blog/[id]
```

**博客列表页：**

```typescript
// app/blog/page.tsx
import Link from 'next/link'

export default async function BlogListPage() {
  // 假设从数据库获取文章列表
  const posts = [
    { id: 1, title: 'Next.js 入门', slug: 'getting-started' },
    { id: 2, title: 'React 基础', slug: 'react-basics' },
    { id: 3, title: 'TypeScript 教程', slug: 'typescript-tutorial' }
  ]
  
  return (
    <div>
      <h1>博客文章列表</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          {/* 动态生成链接 */}
          <Link href={`/blog/${post.id}`}>
            阅读全文
          </Link>
        </article>
      ))}
    </div>
  )
}
```

**博客详情页：**

```typescript
// app/blog/[id]/page.tsx
export default async function BlogPostPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  // 使用 id 参数获取对应的文章
  const post = await fetch(`https://api.example.com/posts/${params.id}`)
    .then(res => res.json())
  
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
    </article>
  )
}
```

**访问示例：**
- `/blog` - 显示博客列表
- `/blog/1` - 显示 ID 为 1 的文章
- `/blog/2` - 显示 ID 为 2 的文章

---

### 示例 2：用户资料页

**目录结构：**

```text
app/
└── user/
    └── [username]/
        └── page.tsx      # 用户资料页：/user/[username]
```

**用户资料页：**

```typescript
// app/user/[username]/page.tsx
export default async function UserProfilePage({ 
  params 
}: { 
  params: { username: string } 
}) {
  // 使用 username 参数获取用户信息
  const user = await fetch(`https://api.example.com/users/${params.username}`)
    .then(res => res.json())
  
  return (
    <div>
      <h1>{user.name}</h1>
      <p>@{params.username}</p>
      <p>{user.bio}</p>
    </div>
  )
}
```

**访问示例：**
- `/user/john` - 显示用户 john 的资料
- `/user/jane` - 显示用户 jane 的资料

---

### 示例 3：多段动态路由

**目录结构：**

```text
app/
└── blog/
    └── [year]/
        └── [month]/
            └── [slug]/
                └── page.tsx    # /blog/[year]/[month]/[slug]
```

**获取多个参数：**

```typescript
// app/blog/[year]/[month]/[slug]/page.tsx
export default async function BlogPostPage({ 
  params 
}: { 
  params: { year: string; month: string; slug: string } 
}) {
  // 获取所有动态参数
  const { year, month, slug } = params
  
  return (
    <div>
      <h1>文章: {slug}</h1>
      <p>发布时间: {year}年{month}月</p>
    </div>
  )
}
```

**访问示例：**
- `/blog/2024/01/my-post` 
  - `year = "2024"`
  - `month = "01"`
  - `slug = "my-post"`

---

## 2.5 参数类型

### 参数总是字符串

**重要**：`params` 中的值总是字符串类型，即使 URL 中是数字。

```typescript
// 访问 /blog/123
export default function Page({ params }: { params: { id: string } }) {
  // params.id 是字符串 "123"，不是数字 123
  const id = parseInt(params.id) // 需要转换为数字
  return <div>ID: {id}</div>
}
```

### 类型定义

```typescript
// 单个参数
params: { id: string }

// 多个参数
params: { year: string; month: string; slug: string }

// 使用 TypeScript 类型
interface PageProps {
  params: {
    id: string
  }
}

export default function Page({ params }: PageProps) {
  // ...
}
```

---

## 2.6 动态路由的实际使用场景

### 场景 1：博客文章详情

```text
app/blog/[slug]/page.tsx
```

- `/blog/getting-started` - 显示"getting-started"文章
- `/blog/react-tutorial` - 显示"react-tutorial"文章

### 场景 2：产品详情页

```text
app/products/[id]/page.tsx
```

- `/products/123` - 显示 ID 为 123 的产品
- `/products/456` - 显示 ID 为 456 的产品

### 场景 3：用户资料页

```text
app/user/[username]/page.tsx
```

- `/user/john` - 显示用户 john 的资料
- `/user/jane` - 显示用户 jane 的资料

---

## 2.7 错误处理

### 处理不存在的资源

```typescript
// app/blog/[id]/page.tsx
import { notFound } from 'next/navigation'

export default async function BlogPostPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  const post = await fetch(`https://api.example.com/posts/${params.id}`)
    .then(res => res.json())
  
  // 如果文章不存在，显示 404 页面
  if (!post) {
    notFound()
  }
  
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
    </article>
  )
}
```

---

## 2.8 实践练习

### 练习 1：创建博客详情页

1. 创建 `app/blog/[id]/page.tsx`
2. 使用 `params.id` 获取文章 ID
3. 根据 ID 显示对应的文章内容

### 练习 2：创建用户资料页

1. 创建 `app/user/[username]/page.tsx`
2. 使用 `params.username` 获取用户名
3. 显示用户的基本信息

---

## 2.9 总结

### 关键要点

1. **动态路由语法**：使用 `[param]` 创建动态路由段
2. **获取参数**：通过 `params` prop 获取路由参数
3. **参数类型**：`params` 中的值总是字符串
4. **多段路由**：可以创建多个动态路由段
5. **错误处理**：使用 `notFound()` 处理不存在的资源

### 下一步

完成动态路由学习后，可以学习**路由组**，了解如何组织不同功能模块的路由。


# 第一阶段：基础概念

## 1. Next.js 简介与环境搭建

### 1.1 Next.js 是什么？

Next.js 是一个基于 React 的全栈框架，由 Vercel 开发。它提供了：

- **服务端渲染（SSR）**：在服务器上渲染 React 组件
- **静态站点生成（SSG）**：在构建时生成静态页面
- **API 路由**：无需单独的后端服务器，可以在 Next.js 中创建 API
- **文件系统路由**：基于文件结构自动创建路由
- **自动代码分割**：优化性能，只加载需要的代码
- **内置 CSS 支持**：支持 CSS Modules、Tailwind CSS 等

### 1.2 环境搭建

#### 前置要求

- Node.js 18+
- npm、yarn 或 pnpm

#### 创建 Next.js 项目

```bash
# 使用 create-next-app 创建项目
npx create-next-app@latest learn-nextjs

# 选择配置选项：
# - TypeScript: Yes
# - ESLint: Yes
# - Tailwind CSS: Yes
# - App Router: Yes
# - src/ directory: No（使用根目录的 app/）
# - import alias: @/*
```

#### 启动开发服务器

```bash
cd learn-nextjs
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000) 查看应用。

---

## 2. 项目结构理解

### 2.1 核心目录结构

```text
learn-nextjs/
├── app/                    # App Router 目录（核心）
│   ├── layout.tsx         # 根布局
│   ├── page.tsx           # 首页
│   ├── globals.css        # 全局样式
│   ├── api/               # API 路由
│   └── components/        # 组件目录
├── public/                # 静态资源（图片、字体等）
├── next.config.js         # Next.js 配置文件
├── tsconfig.json          # TypeScript 配置
├── tailwind.config.ts     # Tailwind CSS 配置
└── package.json           # 项目依赖
```

### 2.2 重要文件说明

- **`app/layout.tsx`**：根布局组件，所有页面都会使用这个布局
- **`app/page.tsx`**：首页组件，对应路由 `/`
- **`app/globals.css`**：全局样式文件
- **`app/api/`**：API 路由目录，用于创建后端 API
- **`public/`**：静态资源目录，可通过 `/文件名` 直接访问

---

## 3. 路径别名配置

### 3.1 默认路径别名

Next.js 默认配置了 `@/` 别名，指向项目根目录：

```typescript
// 使用路径别名
import Button from '@/app/components/Button'
import { fetchData } from '@/app/utils/api'

// 而不是相对路径
import Button from '../../components/Button'
import { fetchData } from '../utils/api'
```

### 3.2 配置路径别名

路径别名在 `tsconfig.json` 中配置：

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  }
}
```

### 3.3 使用路径别名的好处

- ✅ 代码更清晰，避免 `../../../` 这样的相对路径
- ✅ 重构时更容易，移动文件不需要修改导入路径
- ✅ 提高代码可读性

---

## 4. App Router vs Pages Router

### 4.1 为什么使用 App Router？

Next.js 13+ 引入了 **App Router**，这是推荐的新架构：

- ✅ **更好的性能**：支持 React Server Components
- ✅ **更灵活的路由**：支持嵌套布局、并行路由等
- ✅ **更好的数据获取**：支持流式渲染、Suspense
- ✅ **更简洁的 API**：使用 `async/await` 在组件中获取数据

### 4.2 App Router vs Pages Router 对比

| 特性 | App Router | Pages Router |
|------|-----------|--------------|
| 文件位置 | `app/` 目录 | `pages/` 目录 |
| 路由文件 | `page.tsx` | `index.tsx` 或文件名 |
| 布局文件 | `layout.tsx` | `_app.tsx` |
| 数据获取 | 组件中直接 `async` | `getServerSideProps` 等 |
| 默认组件类型 | 服务端组件 | 客户端组件 |

### 4.3 文件系统路由工作原理

在 App Router 中，**文件夹结构 = 路由路径**：

```text
app/
├── page.tsx              → /
├── about/
│   └── page.tsx          → /about
├── blog/
│   ├── page.tsx          → /blog
│   └── [id]/
│       └── page.tsx      → /blog/[id]
└── contact/
    └── page.tsx          → /contact
```

---

## 5. 服务端组件 vs 客户端组件

### 5.1 默认：服务端组件

在 App Router 中，**默认所有组件都是服务端组件**：

```typescript
// app/components/ServerComponent.tsx
// 这是一个服务端组件（默认）
export default function ServerComponent() {
  // 可以直接访问数据库、文件系统等
  const data = await fetch('https://api.example.com/data')
  
  return <div>{data.title}</div>
}
```

**服务端组件的特点：**

- ✅ 在服务器上运行，减少客户端 JavaScript 体积
- ✅ 可以直接访问数据库、文件系统、环境变量
- ✅ 更快的首屏加载
- ❌ 不能使用浏览器 API（如 `window`、`localStorage`）
- ❌ 不能使用 React Hooks（如 `useState`、`useEffect`）
- ❌ 不能使用事件处理器（如 `onClick`）

### 5.2 客户端组件：使用 `'use client'`

当需要交互性时，使用 `'use client'` 指令：

```typescript
// app/components/ClientComponent.tsx
'use client'  // 必须放在文件顶部

import { useState } from 'react'

export default function ClientComponent() {
  const [count, setCount] = useState(0)
  
  return (
    <button onClick={() => setCount(count + 1)}>
      点击次数: {count}
    </button>
  )
}
```

**客户端组件的特点：**

- ✅ 可以使用 React Hooks
- ✅ 可以使用事件处理器
- ✅ 可以访问浏览器 API
- ❌ 增加客户端 JavaScript 体积
- ❌ 不能直接访问数据库或文件系统

### 5.3 何时使用哪种组件？

**使用服务端组件：**

- 获取数据
- 访问后端资源（数据库、API）
- 保持敏感信息在服务器上（API 密钥、令牌等）
- 减少客户端 JavaScript 体积

**使用客户端组件：**

- 添加交互性（onClick、onChange 等）
- 使用 React Hooks（useState、useEffect 等）
- 使用浏览器 API（localStorage、window 等）
- 使用第三方库（需要客户端交互的）

### 5.4 实践：创建服务端和客户端组件

**服务端组件示例：**

```typescript
// app/components/ServerData.tsx
export default async function ServerData() {
  // 在服务端获取数据
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store' // 禁用缓存
  })
  const data = await res.json()
  
  return <div>服务端数据: {data.title}</div>
}
```

**客户端组件示例：**

```typescript
// app/components/Counter.tsx
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)
  
  return (
    <div>
      <p>计数: {count}</p>
      <button onClick={() => setCount(count + 1)}>增加</button>
      <button onClick={() => setCount(count - 1)}>减少</button>
    </div>
  )
}
```

---

## 6. 理解 Layout 和 Page

### 6.1 Layout（布局）

**`layout.tsx`** 用于定义页面的共享布局结构：

```typescript
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        <header>导航栏</header>
        <main>{children}</main>
        <footer>页脚</footer>
      </body>
    </html>
  )
}
```

**Layout 的特点：**

- ✅ 在路由切换时**不会重新渲染**
- ✅ 可以嵌套，创建嵌套布局
- ✅ 可以共享状态和样式
- ✅ 可以包含共享的 UI 元素（导航栏、页脚等）

### 6.2 Page（页面）

**`page.tsx`** 定义页面的内容：

```typescript
// app/page.tsx
export default function HomePage() {
  return <h1>首页</h1>
}
```

**Page 的特点：**

- ✅ 每个路由必须有一个 `page.tsx`
- ✅ 可以获取数据（使用 `async`）
- ✅ 在路由切换时会重新渲染

### 6.3 嵌套布局

可以创建嵌套布局：

```text
app/
├── layout.tsx              # 根布局（所有页面共享）
├── dashboard/
│   ├── layout.tsx          # Dashboard 布局（/dashboard/* 共享）
│   ├── page.tsx            # /dashboard
│   └── settings/
│       └── page.tsx         # /dashboard/settings
```

**嵌套布局示例：**

```typescript
// app/dashboard/layout.tsx
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div>
      <nav>Dashboard 导航</nav>
      <aside>侧边栏</aside>
      <main>{children}</main>
    </div>
  )
}
```

### 6.4 Layout 和 Page 的关系

```text
app/
├── layout.tsx          # 根布局
│   └── app/
│       └── page.tsx    # 首页内容
│
# 渲染结果：
<html>
  <body>
    <header>导航栏</header>
    <main>
      <h1>首页</h1>      {/* page.tsx 的内容 */}
    </main>
    <footer>页脚</footer>
  </body>
</html>
```

---

## 7. 总结

### 关键概念回顾

1. **App Router**：Next.js 13+ 的新路由系统，基于 `app/` 目录
2. **服务端组件**：默认组件类型，在服务器上运行，减少客户端 JavaScript
3. **客户端组件**：使用 `'use client'`，支持交互性和 React Hooks
4. **Layout**：共享的布局结构，路由切换时不重新渲染
5. **Page**：页面的具体内容，每个路由必须有一个 `page.tsx`

### 最佳实践

- ✅ 默认使用服务端组件，只在需要交互时使用客户端组件
- ✅ 使用路径别名 `@/` 提高代码可读性
- ✅ 合理使用嵌套布局组织页面结构
- ✅ 在服务端组件中获取数据，减少客户端负担

### 下一步

完成第一阶段后，可以进入第二阶段：**路由系统**，学习静态路由、动态路由、路由组等高级路由功能。

---

**学习进度：** ✅ 第一阶段完成

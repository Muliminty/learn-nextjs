# 项目结构理解

## 2.1 核心目录结构

```text
learn-nextjs/
├── app/                    # App Router 目录（核心）
│   ├── layout.tsx         # 根布局
│   ├── page.tsx           # 首页
│   ├── globals.css        # 全局样式
│   ├── api/               # API 路由
│   └── components/        # 组件目录
├── public/                # 静态资源（图片、字体等）
├── next.config.js         # Next.js 配置文件
├── tsconfig.json          # TypeScript 配置
├── tailwind.config.ts     # Tailwind CSS 配置
└── package.json           # 项目依赖
```

## 2.2 重要文件说明

- **`app/layout.tsx`**：根布局组件，所有页面都会使用这个布局
- **`app/page.tsx`**：首页组件，对应路由 `/`
- **`app/globals.css`**：全局样式文件
- **`app/api/`**：API 路由目录，用于创建后端 API
- **`public/`**：静态资源目录，可通过 `/文件名` 直接访问

---

## 2.3 规范的目录结构详解

### 完整的推荐目录结构

```text
learn-nextjs/
├── app/                           # App Router 核心目录
│   ├── (auth)/                    # 路由组：认证相关页面（不影响 URL）
│   │   ├── login/
│   │   │   └── page.tsx           # 路由：/login
│   │   └── register/
│   │       └── page.tsx           # 路由：/register
│   ├── (marketing)/               # 路由组：营销页面
│   │   ├── about/
│   │   │   └── page.tsx           # 路由：/about
│   │   └── contact/
│   │       └── page.tsx          # 路由：/contact
│   ├── blog/                      # 博客功能模块
│   │   ├── page.tsx               # 路由：/blog（博客列表）
│   │   ├── BlogList.tsx           # 局部组件（只用于博客页面）
│   │   └── [slug]/                # 动态路由
│   │       ├── page.tsx          # 路由：/blog/[slug]
│   │       └── BlogHeader.tsx    # 局部组件（只用于详情页）
│   ├── dashboard/                 # 仪表板功能模块
│   │   ├── layout.tsx            # 嵌套布局（/dashboard/* 共享）
│   │   ├── page.tsx              # 路由：/dashboard
│   │   └── settings/
│   │       └── page.tsx          # 路由：/dashboard/settings
│   ├── api/                       # API 路由目录
│   │   ├── users/
│   │   │   └── route.ts          # API：/api/users
│   │   └── posts/
│   │       └── route.ts          # API：/api/posts
│   ├── components/                # 共享组件目录（在 app 内部）
│   │   ├── ui/                    # 基础 UI 组件（多个页面使用）
│   │   │   ├── Button.tsx
│   │   │   ├── Card.tsx
│   │   │   ├── Input.tsx
│   │   │   └── Modal.tsx
│   │   ├── layout/                # 布局组件（多个页面使用）
│   │   │   ├── Header.tsx
│   │   │   ├── Footer.tsx
│   │   │   └── Sidebar.tsx
│   │   └── features/              # 功能组件（多个页面使用）
│   │       ├── UserProfile.tsx
│   │       └── SearchBar.tsx
│   ├── lib/                       # 工具函数和配置
│   │   ├── utils.ts              # 通用工具函数
│   │   ├── db.ts                 # 数据库连接
│   │   ├── auth.ts               # 认证相关
│   │   └── constants.ts          # 常量定义
│   ├── hooks/                     # 自定义 Hooks（客户端）
│   │   ├── useAuth.ts
│   │   └── useLocalStorage.ts
│   ├── types/                     # TypeScript 类型定义
│   │   ├── index.ts
│   │   ├── user.ts
│   │   └── post.ts
│   ├── styles/                    # 样式文件（可选）
│   │   └── components.module.css
│   ├── layout.tsx                 # 根布局
│   ├── page.tsx                   # 首页（路由：/）
│   ├── globals.css                # 全局样式
│   ├── loading.tsx                # 全局加载状态
│   ├── error.tsx                  # 全局错误页面
│   └── not-found.tsx              # 404 页面
├── public/                        # 静态资源目录
│   ├── images/                    # 图片资源
│   ├── icons/                     # 图标资源
│   └── fonts/                     # 字体文件
├── .env.local                     # 环境变量（不提交到 Git）
├── .env.example                   # 环境变量示例
├── .gitignore
├── .prettierrc                    # Prettier 配置
├── .eslintrc.json                 # ESLint 配置
├── next.config.ts                 # Next.js 配置
├── tsconfig.json                  # TypeScript 配置
├── tailwind.config.ts             # Tailwind 配置
├── package.json
└── README.md
```

---

### 核心目录详解

#### 1. `app/` 目录 - App Router 核心

**作用**：Next.js App Router 的核心目录，所有路由和页面都在这里定义。

**规范**：

- ✅ 必须放在项目根目录
- ✅ 文件夹结构 = 路由路径
- ✅ 特殊文件名有特殊功能（`page.tsx`、`layout.tsx` 等）

**重要规则**：

- 每个路由文件夹必须包含 `page.tsx`
- 只有 `app/` 目录下的文件夹结构会影响路由
- 使用路由组 `(folderName)` 组织但不影响 URL

**示例**：

```text
app/
├── page.tsx              → 路由：/
├── about/
│   └── page.tsx          → 路由：/about
└── blog/
    ├── page.tsx          → 路由：/blog
    └── [id]/
        └── page.tsx      → 路由：/blog/[id]
```

---

#### 2. `app/components/` 目录 - 共享组件

**作用**：存放可以在多个路由中复用的组件。

**规范**：

- ✅ 必须放在 `app/` 内部（不是与 `app/` 同级）
- ✅ 按功能分类组织（`ui/`、`layout/`、`features/`）
- ✅ 使用通用命名（如 `Button`、`Card`，不要带路由前缀）

**目录结构**：

```text
app/components/
├── ui/                    # 基础 UI 组件（Button、Input、Card 等）
├── layout/                # 布局组件（Header、Footer、Sidebar 等）
└── features/              # 功能组件（UserProfile、SearchBar 等）
```

**使用场景**：

- 组件需要在 2 个或更多路由中使用
- 组件是通用的 UI 元素
- 组件名称不包含特定路由前缀

**导入方式**：

```typescript
import Button from '@/app/components/ui/Button'
import Header from '@/app/components/layout/Header'
```

**❌ 不推荐的做法**：

```text
# 不要与 app 同级
components/          # ❌ 不推荐
app/
```

---

#### 3. 路由文件夹内的组件 - 局部组件

**作用**：存放只用于该路由的组件。

**规范**：

- ✅ 直接放在路由文件夹内（不要创建 `components/` 子目录）
- ✅ 使用带路由前缀的命名（如 `AboutHeader`、`BlogPostCard`）
- ✅ 使用相对路径导入

**示例结构**：

```text
app/blog/
├── page.tsx
├── BlogList.tsx          # ✅ 直接放在路由文件夹内
└── [slug]/
    ├── page.tsx
    └── BlogHeader.tsx    # ✅ 直接放在路由文件夹内
```

**❌ 不推荐的做法**：

```text
app/blog/[slug]/
├── components/           # ❌ 不要创建 components 子目录
│   └── BlogHeader.tsx
└── page.tsx
```

**导入方式**：

```typescript
// app/blog/page.tsx
import BlogList from './BlogList'  // ✅ 相对路径

// app/blog/[slug]/page.tsx
import BlogHeader from './BlogHeader'  // ✅ 相对路径
```

**使用场景**：

- 组件只用于该路由
- 组件包含该路由特定的业务逻辑
- 组件名称包含路由前缀

---

#### 4. `app/lib/` 目录 - 工具函数

**作用**：存放工具函数、配置和业务逻辑。

**规范**：

- ✅ 放在 `app/` 内部
- ✅ 按功能模块组织文件
- ✅ 使用 camelCase 命名

**常见文件**：

```text
app/lib/
├── utils.ts              # 通用工具函数
├── db.ts                 # 数据库连接和操作
├── auth.ts               # 认证相关函数
├── api.ts                # API 调用函数
└── constants.ts          # 常量定义
```

**导入方式**：

```typescript
import { formatDate } from '@/app/lib/utils'
import { db } from '@/app/lib/db'
```

---

#### 5. `app/types/` 目录 - 类型定义

**作用**：存放 TypeScript 类型定义。

**规范**：

- ✅ 放在 `app/` 内部
- ✅ 按功能模块拆分文件
- ✅ 统一从 `index.ts` 导出

**示例结构**：

```text
app/types/
├── index.ts              # 统一导出
├── user.ts                # 用户相关类型
└── post.ts                # 文章相关类型
```

**导入方式**：

```typescript
import type { User, Post } from '@/app/types'
```

---

#### 6. `app/api/` 目录 - API 路由

**作用**：创建后端 API 路由。

**规范**：

- ✅ 每个文件夹对应一个 API 端点
- ✅ 必须包含 `route.ts` 文件
- ✅ 支持 HTTP 方法（GET、POST、PUT、DELETE 等）

**示例结构**：

```text
app/api/
├── users/
│   └── route.ts          # API：/api/users
└── posts/
    └── route.ts          # API：/api/posts
```

**示例代码**：

```typescript
// app/api/users/route.ts
export async function GET() {
  return Response.json({ users: [] })
}

export async function POST(request: Request) {
  const body = await request.json()
  return Response.json({ success: true })
}
```

---

#### 7. `app/hooks/` 目录 - 自定义 Hooks

**作用**：存放自定义 React Hooks（仅客户端）。

**规范**：

- ✅ 放在 `app/` 内部
- ✅ 文件名以 `use` 开头
- ✅ 必须是客户端组件（使用 `'use client'`）

**示例**：

```typescript
// app/hooks/useAuth.ts
'use client'

import { useState } from 'react'

export function useAuth() {
  const [user, setUser] = useState(null)
  // ...
  return { user, login, logout }
}
```

---

#### 8. `public/` 目录 - 静态资源

**作用**：存放静态资源文件。

**规范**：

- ✅ 放在项目根目录
- ✅ 按资源类型组织（`images/`、`icons/`、`fonts/`）
- ✅ 可通过 `/文件名` 直接访问

**示例结构**：

```text
public/
├── images/
│   └── logo.png
├── icons/
│   └── favicon.ico
└── fonts/
    └── custom-font.woff2
```

**使用方式**：

```typescript
// 在组件中使用
<img src="/images/logo.png" alt="Logo" />
```

---

### 特殊文件说明

#### Next.js 特殊文件（必须在 `app/` 目录下）

| 文件名 | 作用 | 位置 |
|--------|------|------|
| `page.tsx` | 定义页面内容 | 每个路由文件夹必须有一个 |
| `layout.tsx` | 定义布局结构 | 根目录或路由文件夹 |
| `loading.tsx` | 加载状态 | 根目录或路由文件夹 |
| `error.tsx` | 错误页面 | 根目录或路由文件夹 |
| `not-found.tsx` | 404 页面 | 根目录 |
| `route.ts` | API 路由处理程序 | `app/api/` 目录下 |

---

### 组件组织最佳实践

#### 判断组件应该放在哪里？

**放在 `app/components/`（共享组件）**：

- ✅ 组件在 2 个或更多路由中使用
- ✅ 组件是通用的 UI 元素（Button、Input、Card）
- ✅ 组件名称不包含特定路由前缀

**放在路由文件夹内（局部组件）**：

- ✅ 组件只用于该路由
- ✅ 组件包含该路由特定的业务逻辑
- ✅ 组件名称包含路由前缀（如 `AboutHeader`）

#### 示例对比

```text
✅ 正确结构：

app/
├── components/
│   ├── ui/
│   │   └── Button.tsx        # 通用按钮（多个页面使用）
│   └── layout/
│       └── Header.tsx         # 全局导航栏（所有页面使用）
├── about/
│   ├── page.tsx
│   └── AboutHero.tsx          # 只用于 about 页面
└── blog/
    ├── page.tsx
    └── BlogPostList.tsx       # 只用于 blog 页面
```

```text
❌ 错误结构：

# 1. components 与 app 同级
components/          # ❌ 不推荐
app/

# 2. 在路由文件夹内创建 components 子目录
app/blog/[id]/
├── components/      # ❌ 不推荐
│   └── BlogHeader.tsx
└── page.tsx
```

---

### 导入路径规范

#### 使用路径别名 `@/`

```typescript
// ✅ 推荐：使用路径别名
import Button from '@/app/components/ui/Button'
import { formatDate } from '@/app/lib/utils'
import type { User } from '@/app/types'

// ❌ 不推荐：相对路径
import Button from '../../../components/ui/Button'
```

#### 局部组件使用相对路径

```typescript
// ✅ 推荐：局部组件使用相对路径
// app/blog/page.tsx
import BlogList from './BlogList'

// app/blog/[slug]/page.tsx
import BlogHeader from './BlogHeader'
```

---

### 命名规范

#### 组件文件命名

```typescript
// ✅ 推荐：PascalCase
Button.tsx
UserProfile.tsx
BlogPostCard.tsx

// ❌ 不推荐
button.tsx
user-profile.tsx
```

#### 工具函数文件命名

```typescript
// ✅ 推荐：camelCase
utils.ts
formatDate.ts
validateEmail.ts

// ❌ 不推荐
Utils.ts
format-date.ts
```

#### 组件命名规范

```typescript
// 共享组件：通用命名
app/components/ui/Button.tsx
app/components/ui/Card.tsx

// 局部组件：带路由前缀
app/about/AboutHeader.tsx
app/blog/BlogPostList.tsx
```

---

### 常见问题解答

#### Q1: `components/` 必须放在 `app/` 里面吗？

**A**: 是的，推荐放在 `app/` 内部。原因：

- 符合 Next.js 官方约定
- 路径别名统一（`@/app/components/...`）
- 代码组织更清晰

#### Q2: 可以在路由文件夹内创建 `components/` 子目录吗？

**A**: 不推荐。应该直接放在路由文件夹内：

```text
✅ 推荐：
app/blog/[id]/
├── BlogHeader.tsx
└── page.tsx

❌ 不推荐：
app/blog/[id]/
├── components/
│   └── BlogHeader.tsx
└── page.tsx
```

#### Q3: 路由文件夹内的组件可以跨路由使用吗？

**A**: 技术上可以，但不推荐。如果需要在多个路由使用，应该移到 `app/components/`。

#### Q4: 如何判断组件应该放在哪里？

**A**:

- 需要跨路由复用 → `app/components/`
- 只用于一个路由 → 路由文件夹内


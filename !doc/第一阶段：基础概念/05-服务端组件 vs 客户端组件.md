# æœåŠ¡ç«¯ç»„ä»¶ vs å®¢æˆ·ç«¯ç»„ä»¶

> ğŸ“‹ **ç›®å½•**
> 
> - [5.1 åŸºç¡€æ¦‚å¿µ](#51-åŸºç¡€æ¦‚å¿µ)
> - [5.2 æœåŠ¡ç«¯ç»„ä»¶è¯¦è§£](#52-æœåŠ¡ç«¯ç»„ä»¶è¯¦è§£)
> - [5.3 å®¢æˆ·ç«¯ç»„ä»¶è¯¦è§£](#53-å®¢æˆ·ç«¯ç»„ä»¶è¯¦è§£)
> - [5.4 ä¸¤è€…å¯¹æ¯”](#54-ä¸¤è€…å¯¹æ¯”)
> - [5.5 ä½•æ—¶ä½¿ç”¨å“ªç§ç»„ä»¶ï¼Ÿ](#55-ä½•æ—¶ä½¿ç”¨å“ªç§ç»„ä»¶)
> - [5.6 åŸºç¡€å®è·µ](#56-åŸºç¡€å®è·µ)
> - [5.7 æœåŠ¡ç«¯ç»„ä»¶å¼€å‘è¿›é˜¶](#57-æœåŠ¡ç«¯ç»„ä»¶å¼€å‘è¿›é˜¶)
> - [5.8 æœåŠ¡ç«¯ç»„ä»¶ä¸æ•°æ®åº“é€šä¿¡](#58-æœåŠ¡ç«¯ç»„ä»¶ä¸æ•°æ®åº“é€šä¿¡)
> - [5.9 ä»£ç ç»„ç»‡æœ€ä½³å®è·µ](#59-ä»£ç ç»„ç»‡æœ€ä½³å®è·µ)
> - [5.10 æœ€ä½³å®è·µæ€»ç»“](#510-æœ€ä½³å®è·µæ€»ç»“)

---

## 5.1 åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶ï¼Ÿ

åœ¨ Next.js App Router ä¸­ï¼Œç»„ä»¶åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š

1. **æœåŠ¡ç«¯ç»„ä»¶ï¼ˆServer Componentsï¼‰**ï¼šåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ç»„ä»¶
2. **å®¢æˆ·ç«¯ç»„ä»¶ï¼ˆClient Componentsï¼‰**ï¼šåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ç»„ä»¶

### é»˜è®¤è¡Œä¸º

**é‡è¦**ï¼šåœ¨ App Router ä¸­ï¼Œ**é»˜è®¤æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯æœåŠ¡ç«¯ç»„ä»¶**ã€‚

è¿™æ„å‘³ç€ï¼š
- âœ… ä½ ä¸éœ€è¦åšä»»ä½•ç‰¹æ®Šæ ‡è®°ï¼Œç»„ä»¶å°±æ˜¯æœåŠ¡ç«¯ç»„ä»¶
- âœ… å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿç­‰æœåŠ¡å™¨èµ„æº
- âœ… ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œä¸ä¼šå‘é€åˆ°å®¢æˆ·ç«¯

---

## 5.2 æœåŠ¡ç«¯ç»„ä»¶è¯¦è§£

### 5.2.1 åŸºæœ¬ç‰¹ç‚¹

æœåŠ¡ç«¯ç»„ä»¶æ˜¯ Next.js App Router çš„é»˜è®¤ç»„ä»¶ç±»å‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

**âœ… ä¼˜åŠ¿ï¼š**

- åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå‡å°‘å®¢æˆ·ç«¯ JavaScript ä½“ç§¯
- å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€ç¯å¢ƒå˜é‡
- æ›´å¿«çš„é¦–å±åŠ è½½ï¼ˆæ•°æ®å·²åŒ…å«åœ¨ HTML ä¸­ï¼‰
- SEO å‹å¥½ï¼ˆå†…å®¹åœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼‰

**âŒ é™åˆ¶ï¼š**

- ä¸èƒ½ä½¿ç”¨æµè§ˆå™¨ APIï¼ˆå¦‚ `window`ã€`localStorage`ï¼‰
- ä¸èƒ½ä½¿ç”¨ React Hooksï¼ˆå¦‚ `useState`ã€`useEffect`ï¼‰
- ä¸èƒ½ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨ï¼ˆå¦‚ `onClick`ï¼‰

### 5.2.2 åŸºæœ¬ç»“æ„

```typescript
// app/components/ServerComponent.tsx
// æ³¨æ„ï¼šè¿™æ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼Œä¸éœ€è¦ 'use client'

// âœ… å¯ä»¥ç›´æ¥ä½¿ç”¨ async
export default async function ServerComponent() {
  // âœ… å¯ä»¥ç›´æ¥ä½¿ç”¨ await è·å–æ•°æ®
  const data = await fetch('https://api.example.com/data')
  const json = await data.json()
  
  return <div>{json.title}</div>
}
```

### 5.2.3 å…³é”®ç‰¹æ€§

**1. å¯ä»¥ç›´æ¥ä½¿ç”¨ `async/await`**

è¿™æ˜¯æœåŠ¡ç«¯ç»„ä»¶ä¸å®¢æˆ·ç«¯ç»„ä»¶æœ€å¤§çš„åŒºåˆ«ä¹‹ä¸€ï¼š

```typescript
// âœ… æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ä½¿ç”¨ async
export default async function ServerComponent() {
  const data = await fetchData()
  return <div>{data}</div>
}
```

**2. å¯ä»¥ç›´æ¥è®¿é—®æœåŠ¡å™¨èµ„æº**

```typescript
// âœ… å¯ä»¥è®¿é—®æ•°æ®åº“
import { db } from '@/app/lib/db'
const users = await db.query('SELECT * FROM users')

// âœ… å¯ä»¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ
import fs from 'fs'
const file = await fs.promises.readFile('data.txt')

// âœ… å¯ä»¥è®¿é—®ç¯å¢ƒå˜é‡
const apiKey = process.env.API_KEY
```

**3. åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**

æœåŠ¡ç«¯ç»„ä»¶çš„ä»£ç åªåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä¸ä¼šå‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€ï¼š
- æ•æ„Ÿä¿¡æ¯ï¼ˆAPI å¯†é’¥ã€æ•°æ®åº“å¯†ç ï¼‰ä¸ä¼šæš´éœ²
- å‡å°‘å®¢æˆ·ç«¯ JavaScript ä½“ç§¯
- æé«˜å®‰å…¨æ€§

---

## 5.3 å®¢æˆ·ç«¯ç»„ä»¶è¯¦è§£

### 5.3.1 å¦‚ä½•åˆ›å»ºå®¢æˆ·ç«¯ç»„ä»¶

å½“éœ€è¦äº¤äº’æ€§æ—¶ï¼Œä½¿ç”¨ `'use client'` æŒ‡ä»¤ï¼š

```typescript
// app/components/ClientComponent.tsx
'use client'  // âš ï¸ å¿…é¡»æ”¾åœ¨æ–‡ä»¶æœ€é¡¶éƒ¨

import { useState } from 'react'

export default function ClientComponent() {
  const [count, setCount] = useState(0)
  
  return (
    <button onClick={() => setCount(count + 1)}>
      ç‚¹å‡»æ¬¡æ•°: {count}
    </button>
  )
}
```

**é‡è¦æç¤º**ï¼š
- `'use client'` å¿…é¡»æ”¾åœ¨æ–‡ä»¶çš„æœ€é¡¶éƒ¨
- å¿…é¡»åœ¨æ‰€æœ‰ import è¯­å¥ä¹‹å‰
- ä¸€æ—¦ä½¿ç”¨ `'use client'`ï¼Œè¯¥æ–‡ä»¶åŠå…¶æ‰€æœ‰å¯¼å…¥çš„ç»„ä»¶éƒ½ä¼šå˜æˆå®¢æˆ·ç«¯ç»„ä»¶

### 5.3.2 åŸºæœ¬ç‰¹ç‚¹

**âœ… ä¼˜åŠ¿ï¼š**

- å¯ä»¥ä½¿ç”¨ React Hooksï¼ˆ`useState`ã€`useEffect` ç­‰ï¼‰
- å¯ä»¥ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨ï¼ˆ`onClick`ã€`onChange` ç­‰ï¼‰
- å¯ä»¥è®¿é—®æµè§ˆå™¨ APIï¼ˆ`localStorage`ã€`window` ç­‰ï¼‰
- æ”¯æŒç”¨æˆ·äº¤äº’

**âŒ é™åˆ¶ï¼š**

- å¢åŠ å®¢æˆ·ç«¯ JavaScript ä½“ç§¯
- ä¸èƒ½ç›´æ¥è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿ
- ä»£ç ä¼šå‘é€åˆ°å®¢æˆ·ç«¯ï¼Œæ•æ„Ÿä¿¡æ¯å¯èƒ½æš´éœ²

### 5.3.3 ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

```typescript
// app/components/Counter.tsx
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)
  
  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
      <button onClick={() => setCount(count - 1)}>å‡å°‘</button>
    </div>
  )
}
```

---

## 5.4 ä¸¤è€…å¯¹æ¯”

### 5.4.1 åŠŸèƒ½å¯¹æ¯”è¡¨

| ç‰¹æ€§ | æœåŠ¡ç«¯ç»„ä»¶ | å®¢æˆ·ç«¯ç»„ä»¶ |
|------|-----------|-----------|
| **é»˜è®¤ç±»å‹** | âœ… æ˜¯ï¼ˆä¸éœ€è¦æ ‡è®°ï¼‰ | âŒ éœ€è¦ `'use client'` |
| **æ‰§è¡Œä½ç½®** | æœåŠ¡å™¨ | æµè§ˆå™¨ |
| **async/await** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒï¼ˆåœ¨ç»„ä»¶å‡½æ•°ä¸­ï¼‰ |
| **React Hooks** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **äº‹ä»¶å¤„ç†å™¨** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **æµè§ˆå™¨ API** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **æ•°æ®åº“è®¿é—®** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **æ–‡ä»¶ç³»ç»Ÿ** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **ç¯å¢ƒå˜é‡** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **JavaScript ä½“ç§¯** | å°ï¼ˆä¸å‘é€åˆ°å®¢æˆ·ç«¯ï¼‰ | å¤§ï¼ˆå‘é€åˆ°å®¢æˆ·ç«¯ï¼‰ |
| **SEO** | å‹å¥½ | ä¸å‹å¥½ |
| **é¦–å±åŠ è½½** | å¿« | æ…¢ |

### 5.4.2 ä»£ç ç¤ºä¾‹å¯¹æ¯”

**æœåŠ¡ç«¯ç»„ä»¶ï¼š**

```typescript
// app/components/ServerData.tsx
// ä¸éœ€è¦ 'use client'

export default async function ServerData() {
  // âœ… å¯ä»¥ä½¿ç”¨ async/await
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store'
  })
  const data = await res.json()
  
  // âŒ ä¸èƒ½ä½¿ç”¨ Hooks
  // const [count, setCount] = useState(0) // é”™è¯¯ï¼
  
  // âŒ ä¸èƒ½ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨
  // <button onClick={...}> // é”™è¯¯ï¼
  
  return <div>æœåŠ¡ç«¯æ•°æ®: {data.title}</div>
}
```

**å®¢æˆ·ç«¯ç»„ä»¶ï¼š**

```typescript
// app/components/ClientData.tsx
'use client'  // âœ… å¿…é¡»æ·»åŠ 

import { useState, useEffect } from 'react'

export default function ClientData() {
  // âœ… å¯ä»¥ä½¿ç”¨ Hooks
  const [data, setData] = useState(null)
  
  // âœ… å¯ä»¥ä½¿ç”¨ useEffect
  useEffect(() => {
    fetch('/api/data')
      .then(res => res.json())
      .then(setData)
  }, [])
  
  // âœ… å¯ä»¥ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨
  const handleClick = () => {
    console.log('ç‚¹å‡»äº†')
  }
  
  return (
    <div>
      <p>å®¢æˆ·ç«¯æ•°æ®: {data?.title}</p>
      <button onClick={handleClick}>ç‚¹å‡»</button>
    </div>
  )
}
```

---

## 5.5 ä½•æ—¶ä½¿ç”¨å“ªç§ç»„ä»¶ï¼Ÿ

### 5.5.1 ä½¿ç”¨æœåŠ¡ç«¯ç»„ä»¶çš„åœºæ™¯

**âœ… æ¨èä½¿ç”¨æœåŠ¡ç«¯ç»„ä»¶ï¼š**

1. **è·å–æ•°æ®**
   - ä»æ•°æ®åº“è·å–æ•°æ®
   - ä» API è·å–æ•°æ®
   - ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ•°æ®

2. **è®¿é—®åç«¯èµ„æº**
   - æ•°æ®åº“æŸ¥è¯¢
   - æ–‡ä»¶æ“ä½œ
   - ç¯å¢ƒå˜é‡è®¿é—®

3. **ä¿æŒæ•æ„Ÿä¿¡æ¯å®‰å…¨**
   - API å¯†é’¥
   - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
   - è®¤è¯ä»¤ç‰Œ

4. **å‡å°‘å®¢æˆ·ç«¯ JavaScript ä½“ç§¯**
   - ä¸éœ€è¦äº¤äº’çš„é™æ€å†…å®¹
   - æ•°æ®å±•ç¤ºç»„ä»¶

**å®é™…ç¤ºä¾‹ï¼š**

```typescript
// âœ… æœåŠ¡ç«¯ç»„ä»¶ï¼šè·å–å¹¶æ˜¾ç¤ºåšå®¢æ–‡ç« åˆ—è¡¨
export default async function BlogListPage() {
  const posts = await fetch('https://api.example.com/posts')
    .then(res => res.json())
  
  return (
    <div>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </article>
      ))}
    </div>
  )
}
```

### 5.5.2 ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶çš„åœºæ™¯

**âœ… éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ï¼š**

1. **æ·»åŠ äº¤äº’æ€§**
   - æŒ‰é’®ç‚¹å‡»ï¼ˆ`onClick`ï¼‰
   - è¡¨å•è¾“å…¥ï¼ˆ`onChange`ï¼‰
   - ç”¨æˆ·äº¤äº’

2. **ä½¿ç”¨ React Hooks**
   - `useState` - çŠ¶æ€ç®¡ç†
   - `useEffect` - å‰¯ä½œç”¨å¤„ç†
   - `useContext` - ä¸Šä¸‹æ–‡

3. **ä½¿ç”¨æµè§ˆå™¨ API**
   - `localStorage` - æœ¬åœ°å­˜å‚¨
   - `window` - çª—å£å¯¹è±¡
   - `navigator` - æµè§ˆå™¨ä¿¡æ¯

4. **ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“**
   - éœ€è¦å®¢æˆ·ç«¯äº¤äº’çš„åº“
   - å›¾è¡¨åº“ã€åŠ¨ç”»åº“ç­‰

**å®é™…ç¤ºä¾‹ï¼š**

```typescript
// âœ… å®¢æˆ·ç«¯ç»„ä»¶ï¼šäº¤äº’å¼è®¡æ•°å™¨
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)
  
  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
    </div>
  )
}
```

### 5.5.3 ç»„åˆä½¿ç”¨

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šå¸¸éœ€è¦ç»„åˆä½¿ç”¨ä¸¤ç§ç»„ä»¶ï¼š

```typescript
// app/blog/page.tsx - æœåŠ¡ç«¯ç»„ä»¶
import Counter from '@/app/components/Counter'  // å®¢æˆ·ç«¯ç»„ä»¶

export default async function BlogPage() {
  // âœ… æœåŠ¡ç«¯ç»„ä»¶è·å–æ•°æ®
  const posts = await fetch('https://api.example.com/posts')
    .then(res => res.json())
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« </h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
        </article>
      ))}
      
      {/* âœ… åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ */}
      <Counter />
    </div>
  )
}
```

**é‡è¦è§„åˆ™**ï¼š
- âœ… æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥å¯¼å…¥å’Œä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶
- âŒ å®¢æˆ·ç«¯ç»„ä»¶ä¸èƒ½ç›´æ¥å¯¼å…¥æœåŠ¡ç«¯ç»„ä»¶
- âœ… å¯ä»¥é€šè¿‡ props ä¼ é€’æ•°æ®ç»™å®¢æˆ·ç«¯ç»„ä»¶

---

## 5.6 åŸºç¡€å®è·µ

### 5.6.1 åˆ›å»ºæœåŠ¡ç«¯ç»„ä»¶

**æ­¥éª¤ 1ï¼šåˆ›å»ºç»„ä»¶æ–‡ä»¶ï¼ˆä¸éœ€è¦ 'use client'ï¼‰**

```typescript
// app/components/ServerData.tsx
export default async function ServerData() {
  // åœ¨æœåŠ¡ç«¯è·å–æ•°æ®
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store' // ç¦ç”¨ç¼“å­˜
  })
  const data = await res.json()
  
  return <div>æœåŠ¡ç«¯æ•°æ®: {data.title}</div>
}
```

**æ­¥éª¤ 2ï¼šåœ¨é¡µé¢ä¸­ä½¿ç”¨**

```typescript
// app/page.tsx
import ServerData from '@/app/components/ServerData'

export default function HomePage() {
  return (
    <div>
      <h1>é¦–é¡µ</h1>
      <ServerData />
    </div>
  )
}
```

### 5.6.2 åˆ›å»ºå®¢æˆ·ç«¯ç»„ä»¶

**æ­¥éª¤ 1ï¼šåˆ›å»ºç»„ä»¶æ–‡ä»¶ï¼ˆéœ€è¦ 'use client'ï¼‰**

```typescript
// app/components/Counter.tsx
'use client'  // âš ï¸ å¿…é¡»æ”¾åœ¨æœ€é¡¶éƒ¨

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)
  
  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
      <button onClick={() => setCount(count - 1)}>å‡å°‘</button>
    </div>
  )
}
```

**æ­¥éª¤ 2ï¼šåœ¨é¡µé¢ä¸­ä½¿ç”¨**

```typescript
// app/page.tsx
import Counter from '@/app/components/Counter'

export default function HomePage() {
  return (
    <div>
      <h1>é¦–é¡µ</h1>
      <Counter />
    </div>
  )
}
```

### 5.6.3 åœ¨ Page ç»„ä»¶ä¸­ä½¿ç”¨

**ç¤ºä¾‹ 1ï¼šåšå®¢åˆ—è¡¨é¡µï¼ˆæœåŠ¡ç«¯ç»„ä»¶ï¼‰**

```typescript
// app/blog/page.tsx
export default async function BlogListPage() {
  // âœ… åœ¨æœåŠ¡ç«¯ç›´æ¥è·å–æ•°æ®
  const posts = await fetch('https://api.example.com/posts', {
    cache: 'no-store' // ç¦ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½è·å–æœ€æ–°æ•°æ®
  }).then(res => res.json())
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« åˆ—è¡¨</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </article>
      ))}
    </div>
  )
}
```

**ç¤ºä¾‹ 2ï¼šåšå®¢è¯¦æƒ…é¡µï¼ˆå¸¦åŠ¨æ€è·¯ç”±ï¼‰**

```typescript
// app/blog/[slug]/page.tsx
export default async function BlogPostPage({ 
  params 
}: { 
  params: { slug: string } 
}) {
  // âœ… ä½¿ç”¨åŠ¨æ€è·¯ç”±å‚æ•°è·å–æ•°æ®
  const post = await fetch(`https://api.example.com/posts/${params.slug}`, {
    cache: 'no-store'
  }).then(res => res.json())
  
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
    </article>
  )
}
```

---

## 5.7 æœåŠ¡ç«¯ç»„ä»¶å¼€å‘è¿›é˜¶

### 5.7.1 æ•°æ®è·å–çš„ç¼“å­˜ç­–ç•¥

Next.js æä¾›äº†å¤šç§ç¼“å­˜ç­–ç•¥æ¥æ§åˆ¶æ•°æ®è·å–ï¼š

```typescript
// 1. ç¦ç”¨ç¼“å­˜ï¼ˆæ¯æ¬¡éƒ½è·å–æœ€æ–°æ•°æ®ï¼‰
const data = await fetch('https://api.example.com/data', {
  cache: 'no-store'
})

// 2. ä½¿ç”¨ç¼“å­˜ï¼ˆé»˜è®¤è¡Œä¸ºï¼Œä¼šç¼“å­˜è¯·æ±‚ï¼‰
const data = await fetch('https://api.example.com/data')

// 3. é‡æ–°éªŒè¯ç¼“å­˜ï¼ˆæ¯ 60 ç§’é‡æ–°éªŒè¯ä¸€æ¬¡ï¼‰
const data = await fetch('https://api.example.com/data', {
  next: { revalidate: 60 }
})

// 4. å¼ºåˆ¶ç¼“å­˜ï¼ˆç¼“å­˜ç›´åˆ°æ‰‹åŠ¨æ¸…é™¤ï¼‰
const data = await fetch('https://api.example.com/data', {
  cache: 'force-cache'
})
```

**ä½¿ç”¨å»ºè®®ï¼š**

- **`cache: 'no-store'`**ï¼šç”¨äºéœ€è¦å®æ—¶æ•°æ®çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€å®æ—¶æ•°æ®ï¼‰
- **é»˜è®¤ç¼“å­˜**ï¼šç”¨äºä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼ˆå¦‚é™æ€å†…å®¹ï¼‰
- **`revalidate`**ï¼šç”¨äºéœ€è¦å®šæœŸæ›´æ–°çš„æ•°æ®ï¼ˆå¦‚æ–°é—»ã€åšå®¢æ–‡ç« ï¼‰

### 5.7.2 é”™è¯¯å¤„ç†

```typescript
// app/blog/[slug]/page.tsx
import { notFound } from 'next/navigation'

export default async function BlogPostPage({ 
  params 
}: { 
  params: { slug: string } 
}) {
  try {
    const post = await fetch(`https://api.example.com/posts/${params.slug}`, {
      cache: 'no-store'
    }).then(res => {
      if (!res.ok) {
        throw new Error('Failed to fetch post')
      }
      return res.json()
    })
    
    if (!post) {
      notFound() // æ˜¾ç¤º 404 é¡µé¢
    }
    
    return (
      <article>
        <h1>{post.title}</h1>
        <div>{post.content}</div>
      </article>
    )
  } catch (error) {
    // å¤„ç†é”™è¯¯
    return <div>åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>
  }
}
```

---

## 5.8 æœåŠ¡ç«¯ç»„ä»¶ä¸æ•°æ®åº“é€šä¿¡

### 5.8.1 ä¸ºä»€ä¹ˆæœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Ÿ

æœåŠ¡ç«¯ç»„ä»¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå› æ­¤å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ— éœ€é€šè¿‡ API è·¯ç”±ã€‚è¿™å¸¦æ¥äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… **æ›´å¿«çš„å“åº”é€Ÿåº¦**ï¼šå‡å°‘äº†ä¸€æ¬¡ HTTP è¯·æ±‚
- âœ… **æ›´å°‘çš„ç½‘ç»œå¼€é”€**ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢
- âœ… **æ›´å®‰å…¨**ï¼šæ•°æ®åº“è¿æ¥ä¿¡æ¯ä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯

### 5.8.2 æ–¹æ³• 1ï¼šç›´æ¥ä½¿ç”¨æ•°æ®åº“å®¢æˆ·ç«¯

#### ä½¿ç”¨ SQLite + better-sqlite3

**ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–**

```bash
npm install better-sqlite3
npm install @types/better-sqlite3 --save-dev
```

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¿æ¥**

```typescript
// app/lib/db.ts - æ•°æ®åº“è¿æ¥æ–‡ä»¶
import Database from 'better-sqlite3'

const db = new Database('database.db')

// åˆ›å»ºè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
db.exec(`
  CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    slug TEXT NOT NULL UNIQUE
  )
`)

export { db }
```

**ç¬¬ä¸‰æ­¥ï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
// app/blog/page.tsx
import { db } from '@/app/lib/db'

export default async function BlogListPage() {
  // âœ… æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“
  const posts = db.prepare('SELECT * FROM posts').all()
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« åˆ—è¡¨</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.content}</p>
        </article>
      ))}
    </div>
  )
}
```

#### ä½¿ç”¨ PostgreSQL + pg

**ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–**

```bash
npm install pg
npm install @types/pg --save-dev
```

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¿æ¥**

```typescript
// app/lib/db.ts
import { Pool } from 'pg'

const pool = new Pool({
  connectionString: process.env.DATABASE_URL
})

export { pool }
```

**ç¬¬ä¸‰æ­¥ï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
// app/blog/page.tsx
import { pool } from '@/app/lib/db'

export default async function BlogListPage() {
  // âœ… æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
  const result = await pool.query('SELECT * FROM posts')
  const posts = result.rows
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« åˆ—è¡¨</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.content}</p>
        </article>
      ))}
    </div>
  )
}
```

### 5.8.3 æ–¹æ³• 2ï¼šä½¿ç”¨ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰

ORM æä¾›äº†æ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤çš„æ•°æ®åº“è®¿é—®æ–¹å¼ã€‚

#### ä½¿ç”¨ Drizzle ORM

**ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–**

```bash
npm install drizzle-orm better-sqlite3
npm install drizzle-kit --save-dev
```

**ç¬¬äºŒæ­¥ï¼šå®šä¹‰æ•°æ®æ¨¡å‹**

```typescript
// app/lib/schema.ts - å®šä¹‰æ•°æ®æ¨¡å‹
import { sqliteTable, text, integer } from 'drizzle-orm/sqlite-core'

export const posts = sqliteTable('posts', {
  id: integer('id').primaryKey(),
  title: text('title').notNull(),
  content: text('content').notNull(),
  slug: text('slug').notNull().unique(),
  createdAt: integer('created_at', { mode: 'timestamp' })
})
```

**ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¿æ¥**

```typescript
// app/lib/db.ts
import { drizzle } from 'drizzle-orm/better-sqlite3'
import Database from 'better-sqlite3'

const sqlite = new Database('database.db')
export const db = drizzle(sqlite)
```

**ç¬¬å››æ­¥ï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
// app/blog/page.tsx
import { db } from '@/app/lib/db'
import { posts } from '@/app/lib/schema'

export default async function BlogListPage() {
  // âœ… ä½¿ç”¨ ORM æŸ¥è¯¢æ•°æ®
  const allPosts = await db.select().from(posts)
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« åˆ—è¡¨</h1>
      {allPosts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.content}</p>
        </article>
      ))}
    </div>
  )
}
```

#### ä½¿ç”¨ Prisma ORM

**ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–**

```bash
npm install @prisma/client
npm install prisma --save-dev
```

**ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ– Prisma**

```bash
npx prisma init
```

**ç¬¬ä¸‰æ­¥ï¼šå®šä¹‰ Schema**

```prisma
// prisma/schema.prisma
model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  slug      String   @unique
  createdAt DateTime @default(now())
}
```

**ç¬¬å››æ­¥ï¼šç”Ÿæˆå®¢æˆ·ç«¯**

```bash
npx prisma generate
```

**ç¬¬äº”æ­¥ï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
// app/lib/prisma.ts
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()
export default prisma
```

```typescript
// app/blog/page.tsx
import prisma from '@/app/lib/prisma'

export default async function BlogListPage() {
  // âœ… ä½¿ç”¨ Prisma æŸ¥è¯¢æ•°æ®
  const posts = await prisma.post.findMany()
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« åˆ—è¡¨</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.content}</p>
        </article>
      ))}
    </div>
  )
}
```

### 5.8.4 æ–¹æ³• 3ï¼šé€šè¿‡ API è·¯ç”±ï¼ˆä¸æ¨èï¼‰

è™½ç„¶æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šé€šè¿‡ API è·¯ç”±æ¥è®¿é—®ï¼š

```typescript
// app/api/posts/route.ts - API è·¯ç”±
import { db } from '@/app/lib/db'

export async function GET() {
  const posts = db.prepare('SELECT * FROM posts').all()
  return Response.json(posts)
}
```

```typescript
// app/blog/page.tsx - æœåŠ¡ç«¯ç»„ä»¶è°ƒç”¨ API
export default async function BlogListPage() {
  // âš ï¸ è™½ç„¶å¯ä»¥ï¼Œä½†ä¸æ¨èï¼ˆå¢åŠ ä¸å¿…è¦çš„å¼€é”€ï¼‰
  const posts = await fetch('http://localhost:3000/api/posts', {
    cache: 'no-store'
  }).then(res => res.json())
  
  return (
    <div>
      <h1>åšå®¢æ–‡ç« åˆ—è¡¨</h1>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
        </article>
      ))}
    </div>
  )
}
```

**ä¸ºä»€ä¹ˆä¸æ¨èï¼Ÿ**

- âŒ å¢åŠ äº†ä¸€æ¬¡ HTTP è¯·æ±‚
- âŒ æ›´æ…¢çš„å“åº”é€Ÿåº¦
- âŒ æ›´å¤šçš„ç½‘ç»œå¼€é”€

**ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ**

- âœ… éœ€è¦ä»å¤–éƒ¨æœåŠ¡è·å–æ•°æ®
- âœ… éœ€è¦ç»Ÿä¸€çš„ API æ¥å£
- âœ… éœ€è¦æ”¯æŒå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨

---

## 5.9 ä»£ç ç»„ç»‡æœ€ä½³å®è·µ

### 5.9.1 âš ï¸ é‡è¦ï¼šä¸è¦å°† SQL ç›´æ¥å†™åœ¨ç»„ä»¶ä¸­

**âŒ ä¸æ¨èçš„åšæ³•ï¼š**

è™½ç„¶æŠ€æœ¯ä¸Šå¯è¡Œï¼Œä½†å°† SQL ç›´æ¥å†™åœ¨ç»„ä»¶ä¸­ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- âŒ **å…³æ³¨ç‚¹åˆ†ç¦»ä¸æ¸…**ï¼šç»„ä»¶åº”è¯¥ä¸“æ³¨äº UIï¼Œä¸åº”è¯¥åŒ…å«æ•°æ®è®¿é—®é€»è¾‘
- âŒ **ä»£ç éš¾ä»¥ç»´æŠ¤**ï¼šSQL æŸ¥è¯¢åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶ä¸­ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†
- âŒ **éš¾ä»¥æµ‹è¯•**ï¼šæ•°æ®åº“é€»è¾‘å’Œ UI é€»è¾‘è€¦åˆåœ¨ä¸€èµ·
- âŒ **éš¾ä»¥å¤ç”¨**ï¼šç›¸åŒçš„æŸ¥è¯¢é€»è¾‘éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤ç¼–å†™

```typescript
// âŒ ä¸æ¨èï¼šSQL ç›´æ¥å†™åœ¨ç»„ä»¶ä¸­
// app/blog/[slug]/page.tsx
import { db } from '@/app/lib/db'

export default async function BlogPostPage({ params }: { params: { slug: string } }) {
  // âŒ SQL æŸ¥è¯¢ç›´æ¥å†™åœ¨ç»„ä»¶ä¸­
  const post = db.prepare('SELECT * FROM posts WHERE slug = ?').get(params.slug)
  
  return <article>{/* ... */}</article>
}
```

### 5.9.2 âœ… æ¨èï¼šå°†æ•°æ®åº“æŸ¥è¯¢é€»è¾‘åˆ†ç¦»

**æ¨èåšæ³•ï¼šå°†æ•°æ®è®¿é—®é€»è¾‘ï¼ˆSQL æŸ¥è¯¢ï¼‰æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œç»„ä»¶åªè´Ÿè´£è°ƒç”¨å’Œæ¸²æŸ“ã€‚**

#### æ¨èçš„ç›®å½•ç»“æ„

```text
app/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts              # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ schema.ts          # æ•°æ®æ¨¡å‹ï¼ˆå¦‚æœä½¿ç”¨ ORMï¼‰
â”‚   â””â”€â”€ queries/           # æ•°æ®è®¿é—®å±‚
â”‚       â”œâ”€â”€ users.ts       # ç”¨æˆ·ç›¸å…³çš„æŸ¥è¯¢
â”‚       â”œâ”€â”€ posts.ts       # åšå®¢æ–‡ç« ç›¸å…³çš„æŸ¥è¯¢
â”‚       â””â”€â”€ comments.ts    # è¯„è®ºç›¸å…³çš„æŸ¥è¯¢
â”œâ”€â”€ users/
â”‚   â””â”€â”€ page.tsx           # ç»„ä»¶åªè´Ÿè´£è°ƒç”¨å’Œæ¸²æŸ“
â””â”€â”€ blog/
    â””â”€â”€ [slug]/
        â””â”€â”€ page.tsx       # ç»„ä»¶åªè´Ÿè´£è°ƒç”¨å’Œæ¸²æŸ“
```

#### ç¤ºä¾‹ 1ï¼šç”¨æˆ·åˆ—è¡¨é¡µï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

**ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¿æ¥æ–‡ä»¶**

```typescript
// app/lib/db.ts - æ•°æ®åº“è¿æ¥
import Database from 'better-sqlite3'

const db = new Database('database.db')

// åˆ›å»ºè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
db.exec(`
  CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT NOT NULL UNIQUE
  )
`)

export { db }
```

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰**

```typescript
// app/lib/queries/users.ts - ç”¨æˆ·ç›¸å…³çš„æ•°æ®åº“æŸ¥è¯¢
import { db } from '@/app/lib/db'

export interface User {
  id: number
  name: string
  email: string
}

// âœ… å°† SQL æŸ¥è¯¢é€»è¾‘å°è£…åœ¨å•ç‹¬çš„å‡½æ•°ä¸­
export async function getAllUsers(): Promise<User[]> {
  return db.prepare('SELECT * FROM users').all() as User[]
}

export async function getUserById(id: number): Promise<User | undefined> {
  return db.prepare('SELECT * FROM users WHERE id = ?').get(id) as User | undefined
}

export async function getUserByEmail(email: string): Promise<User | undefined> {
  return db.prepare('SELECT * FROM users WHERE email = ?').get(email) as User | undefined
}
```

**ç¬¬ä¸‰æ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
// app/users/page.tsx - ç”¨æˆ·åˆ—è¡¨é¡µ
import { getAllUsers } from '@/app/lib/queries/users'

export default async function UsersPage() {
  // âœ… ç»„ä»¶åªè´Ÿè´£è°ƒç”¨æŸ¥è¯¢å‡½æ•°å’Œæ¸²æŸ“ UI
  const users = await getAllUsers()
  
  return (
    <div>
      <h1>ç”¨æˆ·åˆ—è¡¨</h1>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>å§“å</th>
            <th>é‚®ç®±</th>
          </tr>
        </thead>
        <tbody>
          {users.map(user => (
            <tr key={user.id}>
              <td>{user.id}</td>
              <td>{user.name}</td>
              <td>{user.email}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )
}
```

#### ç¤ºä¾‹ 2ï¼šåšå®¢è¯¦æƒ…é¡µï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

**ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåšå®¢ç›¸å…³çš„æŸ¥è¯¢æ–‡ä»¶**

```typescript
// app/lib/queries/posts.ts - åšå®¢æ–‡ç« ç›¸å…³çš„æ•°æ®åº“æŸ¥è¯¢
import { db } from '@/app/lib/db'

export interface Post {
  id: number
  title: string
  content: string
  slug: string
  createdAt: string
}

// âœ… å°† SQL æŸ¥è¯¢é€»è¾‘å°è£…åœ¨å•ç‹¬çš„å‡½æ•°ä¸­
export async function getAllPosts(): Promise<Post[]> {
  return db.prepare('SELECT * FROM posts ORDER BY createdAt DESC').all() as Post[]
}

export async function getPostBySlug(slug: string): Promise<Post | undefined> {
  return db.prepare('SELECT * FROM posts WHERE slug = ?').get(slug) as Post | undefined
}

export async function getPostById(id: number): Promise<Post | undefined> {
  return db.prepare('SELECT * FROM posts WHERE id = ?').get(id) as Post | undefined
}
```

**ç¬¬äºŒæ­¥ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
// app/blog/[slug]/page.tsx
import { getPostBySlug } from '@/app/lib/queries/posts'
import { notFound } from 'next/navigation'

export default async function BlogPostPage({ 
  params 
}: { 
  params: { slug: string } 
}) {
  // âœ… ç»„ä»¶åªè´Ÿè´£è°ƒç”¨æŸ¥è¯¢å‡½æ•°å’Œæ¸²æŸ“ UI
  const post = await getPostBySlug(params.slug)
  
  // âœ… ä½¿ç”¨ Next.js çš„ notFound å‡½æ•°å¤„ç† 404
  if (!post) {
    notFound()
  }
  
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
    </article>
  )
}
```

#### ç¤ºä¾‹ 3ï¼šä½¿ç”¨ ORM çš„æœ€ä½³å®è·µ

**ä½¿ç”¨ Drizzle ORM çš„æ¨èç»“æ„ï¼š**

```typescript
// app/lib/schema.ts - æ•°æ®æ¨¡å‹å®šä¹‰
import { sqliteTable, text, integer } from 'drizzle-orm/sqlite-core'

export const posts = sqliteTable('posts', {
  id: integer('id').primaryKey(),
  title: text('title').notNull(),
  content: text('content').notNull(),
  slug: text('slug').notNull().unique(),
  createdAt: integer('created_at', { mode: 'timestamp' })
})
```

```typescript
// app/lib/queries/posts.ts - ä½¿ç”¨ ORM çš„æŸ¥è¯¢å‡½æ•°
import { db } from '@/app/lib/db'
import { posts } from '@/app/lib/schema'
import { eq } from 'drizzle-orm'

export async function getAllPosts() {
  // âœ… ä½¿ç”¨ ORM æŸ¥è¯¢ï¼Œé€»è¾‘å°è£…åœ¨å•ç‹¬çš„å‡½æ•°ä¸­
  return await db.select().from(posts).orderBy(posts.createdAt)
}

export async function getPostBySlug(slug: string) {
  // âœ… ä½¿ç”¨ ORM æŸ¥è¯¢
  const result = await db.select().from(posts).where(eq(posts.slug, slug)).limit(1)
  return result[0]
}
```

```typescript
// app/blog/[slug]/page.tsx - ç»„ä»¶åªè´Ÿè´£è°ƒç”¨å’Œæ¸²æŸ“
import { getPostBySlug } from '@/app/lib/queries/posts'
import { notFound } from 'next/navigation'

export default async function BlogPostPage({ 
  params 
}: { 
  params: { slug: string } 
}) {
  // âœ… ç»„ä»¶åªè°ƒç”¨æŸ¥è¯¢å‡½æ•°
  const post = await getPostBySlug(params.slug)
  
  if (!post) {
    notFound()
  }
  
  return (
    <article>
      <h1>{post.title}</h1>
      <div>{post.content}</div>
    </article>
  )
}
```

### 5.9.3 ä»£ç ç»„ç»‡çš„å¥½å¤„

**âœ… å…³æ³¨ç‚¹åˆ†ç¦»**
- ç»„ä»¶ä¸“æ³¨äº UI æ¸²æŸ“
- æŸ¥è¯¢å‡½æ•°ä¸“æ³¨äºæ•°æ®è®¿é—®
- èŒè´£æ¸…æ™°ï¼Œæ˜“äºç†è§£

**âœ… æ˜“äºç»´æŠ¤**
- æ‰€æœ‰ SQL æŸ¥è¯¢é›†ä¸­ç®¡ç†
- ä¿®æ”¹æŸ¥è¯¢é€»è¾‘åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹
- ä»£ç ç»“æ„æ¸…æ™°

**âœ… æ˜“äºæµ‹è¯•**
- å¯ä»¥å•ç‹¬æµ‹è¯•æŸ¥è¯¢å‡½æ•°
- å¯ä»¥å•ç‹¬æµ‹è¯•ç»„ä»¶
- æµ‹è¯•æ›´å®¹æ˜“ç¼–å†™å’Œç»´æŠ¤

**âœ… æ˜“äºå¤ç”¨**
- æŸ¥è¯¢å‡½æ•°å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨
- é¿å…é‡å¤ä»£ç 
- æé«˜å¼€å‘æ•ˆç‡

**âœ… ç±»å‹å®‰å…¨**
- å¯ä»¥å®šä¹‰æ¸…æ™°çš„ç±»å‹æ¥å£
- TypeScript å¯ä»¥æä¾›æ›´å¥½çš„ç±»å‹æ£€æŸ¥
- å‡å°‘è¿è¡Œæ—¶é”™è¯¯

### 5.9.4 ä½¿ç”¨ç¯å¢ƒå˜é‡ä¿æŠ¤æ•°æ®åº“è¿æ¥

```typescript
// app/lib/db.ts
import { Pool } from 'pg'

// âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
const pool = new Pool({
  connectionString: process.env.DATABASE_URL, // ä» .env.local è¯»å–
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
})

export { pool }
```

```typescript
// .env.localï¼ˆä¸æäº¤åˆ° Gitï¼‰
DATABASE_URL=postgresql://user:password@localhost:5432/mydb
```

---

## 5.10 æœ€ä½³å®è·µæ€»ç»“

### 5.10.1 âœ… æ¨èåšæ³•

1. **é»˜è®¤ä½¿ç”¨æœåŠ¡ç«¯ç»„ä»¶**ï¼šåªåœ¨éœ€è¦äº¤äº’æ—¶ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶
2. **ç›´æ¥è®¿é—®æ•°æ®åº“**ï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œä¸æ˜¯é€šè¿‡ API
3. **ä½¿ç”¨ async/await**ï¼šå……åˆ†åˆ©ç”¨æœåŠ¡ç«¯ç»„ä»¶çš„å¼‚æ­¥èƒ½åŠ›
4. **ç¯å¢ƒå˜é‡ä¿æŠ¤**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•°æ®åº“è¿æ¥ä¿¡æ¯
5. **ä»£ç åˆ†ç¦»**ï¼šå°†æ•°æ®åº“æŸ¥è¯¢é€»è¾‘åˆ†ç¦»åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­
6. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘
7. **ç¼“å­˜ç­–ç•¥**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥

### 5.10.2 âŒ é¿å…çš„åšæ³•

1. **ä¸è¦åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨æµè§ˆå™¨ API**
   ```typescript
   // âŒ é”™è¯¯
   const data = localStorage.getItem('data')
   ```

2. **ä¸è¦åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ React Hooks**
   ```typescript
   // âŒ é”™è¯¯
   const [count, setCount] = useState(0)
   ```

3. **ä¸è¦å°† SQL ç›´æ¥å†™åœ¨ç»„ä»¶ä¸­**
   ```typescript
   // âŒ ä¸æ¨è
   const post = db.prepare('SELECT * FROM posts WHERE slug = ?').get(slug)
   ```

4. **ä¸è¦å¿˜è®°é”™è¯¯å¤„ç†**
   ```typescript
   // âœ… æ¨è
   try {
     const data = await fetchData()
   } catch (error) {
     // å¤„ç†é”™è¯¯
   }
   ```

### 5.10.3 æ•°æ®è·å–å¯¹æ¯”

| ç‰¹æ€§ | æœåŠ¡ç«¯ç»„ä»¶ | å®¢æˆ·ç«¯ç»„ä»¶ |
|------|-----------|-----------|
| **æ•°æ®è·å–æ–¹å¼** | ç›´æ¥è®¿é—®æ•°æ®åº“/API | é€šè¿‡ `fetch` æˆ– `useEffect` |
| **æ‰§è¡Œä½ç½®** | æœåŠ¡å™¨ | æµè§ˆå™¨ |
| **æ€§èƒ½** | æ›´å¿«ï¼ˆæœåŠ¡å™¨ç«¯æ‰§è¡Œï¼‰ | è¾ƒæ…¢ï¼ˆéœ€è¦ç½‘ç»œè¯·æ±‚ï¼‰ |
| **å®‰å…¨æ€§** | é«˜ï¼ˆæ•æ„Ÿä¿¡æ¯ä¸æš´éœ²ï¼‰ | ä½ï¼ˆä»£ç æš´éœ²ç»™å®¢æˆ·ç«¯ï¼‰ |
| **SEO** | å‹å¥½ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ | ä¸å‹å¥½ï¼ˆå®¢æˆ·ç«¯æ¸²æŸ“ï¼‰ |
| **é¦–å±åŠ è½½** | å¿«ï¼ˆæ•°æ®å·²åŒ…å«åœ¨ HTML ä¸­ï¼‰ | æ…¢ï¼ˆéœ€è¦é¢å¤–è¯·æ±‚ï¼‰ |

**æ¨èçš„æ•°æ®è·å–æ–¹å¼ï¼š**

```typescript
// âœ… æ¨èï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­è·å–æ•°æ®
export default async function Page() {
  const data = await getAllPosts() // ä»æŸ¥è¯¢å‡½æ•°è·å–
  return <div>{/* æ¸²æŸ“æ•°æ® */}</div>
}

// âŒ ä¸æ¨èï¼šåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è·å–æ•°æ®ï¼ˆé™¤éå¿…è¦ï¼‰
'use client'
export default function Page() {
  const [data, setData] = useState(null)
  
  useEffect(() => {
    fetch('/api/posts').then(res => res.json()).then(setData)
  }, [])
  
  return <div>{/* æ¸²æŸ“æ•°æ® */}</div>
}
```

### 5.10.4 å…³é”®è¦ç‚¹æ€»ç»“

**æœåŠ¡ç«¯ç»„ä»¶å¼€å‘è¦ç‚¹ï¼š**

1. **ä½¿ç”¨ `async` å‡½æ•°**ï¼šæœåŠ¡ç«¯ç»„ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ `async/await`
2. **ç›´æ¥è®¿é—®æ•°æ®åº“**ï¼šä¸éœ€è¦é€šè¿‡ APIï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
3. **ä½¿ç”¨ç¯å¢ƒå˜é‡**ï¼šä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼ˆæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ç­‰ï¼‰
4. **ä»£ç åˆ†ç¦»**ï¼šå°†æŸ¥è¯¢é€»è¾‘åˆ†ç¦»åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­
5. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘
6. **ç¼“å­˜ç­–ç•¥**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥

**æ•°æ®åº“é€šä¿¡æ–¹å¼ï¼š**

1. **ç›´æ¥ä½¿ç”¨æ•°æ®åº“å®¢æˆ·ç«¯**ï¼š`better-sqlite3`ã€`pg`ã€`mysql2` ç­‰
2. **ä½¿ç”¨ ORM**ï¼š`Drizzle`ã€`Prisma` ç­‰ï¼ˆæ¨èï¼Œæ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤ï¼‰
3. **é€šè¿‡ API è·¯ç”±**ï¼šè™½ç„¶å¯ä»¥ï¼Œä½†ä¸æ¨èï¼ˆå¢åŠ ä¸å¿…è¦çš„å¼€é”€ï¼‰

**å…³é”®ä¼˜åŠ¿ï¼š**

- ğŸš€ **æ€§èƒ½æ›´å¥½**ï¼šæ•°æ®åœ¨æœåŠ¡å™¨ç«¯è·å–ï¼Œå‡å°‘å®¢æˆ·ç«¯è´Ÿæ‹…
- ğŸ”’ **æ›´å®‰å…¨**ï¼šæ•æ„Ÿä¿¡æ¯ä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯
- ğŸ“ˆ **SEO å‹å¥½**ï¼šå†…å®¹åœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œæœç´¢å¼•æ“å¯ä»¥ç´¢å¼•
- âš¡ **é¦–å±åŠ è½½å¿«**ï¼šæ•°æ®å·²åŒ…å«åœ¨åˆå§‹ HTML ä¸­
- ğŸ› ï¸ **æ˜“äºç»´æŠ¤**ï¼šä»£ç ç»„ç»‡æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»

---

**å­¦ä¹ å»ºè®®**ï¼šä»ç®€å•çš„æœåŠ¡ç«¯ç»„ä»¶å¼€å§‹ï¼Œé€æ­¥å­¦ä¹ æ•°æ®åº“é€šä¿¡å’Œä»£ç ç»„ç»‡æœ€ä½³å®è·µã€‚

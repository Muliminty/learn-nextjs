# 服务端组件 vs 客户端组件

## 5.1 默认：服务端组件

在 App Router 中，**默认所有组件都是服务端组件**：

```typescript
// app/components/ServerComponent.tsx
// 这是一个服务端组件（默认）
export default function ServerComponent() {
  // 可以直接访问数据库、文件系统等
  const data = await fetch('https://api.example.com/data')
  
  return <div>{data.title}</div>
}
```

**服务端组件的特点：**

- ✅ 在服务器上运行，减少客户端 JavaScript 体积
- ✅ 可以直接访问数据库、文件系统、环境变量
- ✅ 更快的首屏加载
- ❌ 不能使用浏览器 API（如 `window`、`localStorage`）
- ❌ 不能使用 React Hooks（如 `useState`、`useEffect`）
- ❌ 不能使用事件处理器（如 `onClick`）

## 5.2 客户端组件：使用 `'use client'`

当需要交互性时，使用 `'use client'` 指令：

```typescript
// app/components/ClientComponent.tsx
'use client'  // 必须放在文件顶部

import { useState } from 'react'

export default function ClientComponent() {
  const [count, setCount] = useState(0)
  
  return (
    <button onClick={() => setCount(count + 1)}>
      点击次数: {count}
    </button>
  )
}
```

**客户端组件的特点：**

- ✅ 可以使用 React Hooks
- ✅ 可以使用事件处理器
- ✅ 可以访问浏览器 API
- ❌ 增加客户端 JavaScript 体积
- ❌ 不能直接访问数据库或文件系统

## 5.3 何时使用哪种组件？

**使用服务端组件：**

- 获取数据
- 访问后端资源（数据库、API）
- 保持敏感信息在服务器上（API 密钥、令牌等）
- 减少客户端 JavaScript 体积

**使用客户端组件：**

- 添加交互性（onClick、onChange 等）
- 使用 React Hooks（useState、useEffect 等）
- 使用浏览器 API（localStorage、window 等）
- 使用第三方库（需要客户端交互的）

## 5.4 实践：创建服务端和客户端组件

**服务端组件示例：**

```typescript
// app/components/ServerData.tsx
export default async function ServerData() {
  // 在服务端获取数据
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store' // 禁用缓存
  })
  const data = await res.json()
  
  return <div>服务端数据: {data.title}</div>
}
```

**客户端组件示例：**

```typescript
// app/components/Counter.tsx
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)
  
  return (
    <div>
      <p>计数: {count}</p>
      <button onClick={() => setCount(count + 1)}>增加</button>
      <button onClick={() => setCount(count - 1)}>减少</button>
    </div>
  )
}
```

